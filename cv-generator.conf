<VirtualHost *:443>
    ServerName haseebsagheer.com

    SSLEngine on
    SSLCertificateFile /etc/letsencrypt/live/haseebsagheer.com/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/haseebsagheer.com/privkey.pem
    Include /etc/letsencrypt/options-ssl-apache.conf

    # ---- CV Generator (keep exactly as you have) ----
    # Let Apache serve .pdf files directly BEFORE proxy
    AliasMatch ^/cv-generator/([^/]+\.pdf)$ /var/www/html/cv-generator/$1
    <FilesMatch "\.pdf$">
        Header set Content-Type application/pdf
        Require all granted
    </FilesMatch>

    # Serve static files (like CSS)
    Alias /cv-generator/static /var/www/html/cv-generator/static
    <Directory /var/www/html/cv-generator/static>
        Require all granted
    </Directory>

    # Proxy only everything ELSE to Gunicorn (cv-generator)
    ProxyPreserveHost On
    ProxyPassMatch ^/cv-generator/((?!.*\.pdf$).*) http://127.0.0.1:8001/$1
    ProxyPassReverse /cv-generator http://127.0.0.1:8001/

    # ---- Fake News Detector (new) ----
    Redirect 301 /fake-news-detector /fake-news-detector/
    ProxyPreserveHost On
    RequestHeader set X-Forwarded-Proto "https"
    ProxyPass        /fake-news-detector/  http://127.0.0.1:8010/
    ProxyPassReverse /fake-news-detector/  http://127.0.0.1:8010/
</VirtualHost>
